(()=>{"use strict";const e=window.React,t=window.wp.blocks,n=window.wp.blockEditor,l=window.wp.components,a=window.wp.element;(0,t.registerBlockType)("bcgovcleanbc/multi-query-content",{edit:({attributes:t,setAttributes:o})=>{const{placeholderText:r,fallbackText:i,paramKeys:c,combinations:m,previewMode:s,previewValues:u,useOrLogic:p,alignment:d="left"}=t,v=(0,n.useBlockProps)({style:{textAlign:d}}),g=(e,t,n)=>{const l=m.map((e=>({...e})));l[e][t]=n,o({combinations:l})},b=m.findIndex((e=>p?c.some((t=>e[t]===u[t])):c.every((t=>e[t]===u[t])))),E=m[b],y=r.replace(/{{\s*value\s*}}/g,E?.value||i);return(0,e.createElement)("div",{...v},(0,e.createElement)(a.Fragment,null,(0,e.createElement)(n.BlockControls,null,(0,e.createElement)(n.AlignmentToolbar,{value:d,onChange:e=>o({alignment:e})})),(0,e.createElement)(n.InspectorControls,null,(0,e.createElement)(l.PanelBody,{title:"Query Parameters"},c.map(((t,n)=>(0,e.createElement)("div",{key:n,style:{marginBottom:"0"}},(0,e.createElement)(l.TextControl,{label:`Param Key #${n+1}`,value:t,onChange:e=>((e,t)=>{const n=[...c];n[e]=t;const l=m.map((e=>({...e})));for(let e=0;e<l.length;e++)l[e]=Object.fromEntries(n.map((t=>{var n;return[t,null!==(n=l[e][t])&&void 0!==n?n:""]}))),l[e].value=m[e]?.value||"";o({paramKeys:n,combinations:l,previewValues:{}})})(n,e)}),(0,e.createElement)("div",{style:{textAlign:"right"}},(0,e.createElement)(l.Button,{isLink:!0,isDestructive:!0,onClick:()=>(e=>{const t=[...c],n=t.splice(e,1)[0],l=m.map((e=>{const t={...e};return delete t[n],t})),a={...u};delete a[n],o({paramKeys:t,combinations:l,previewValues:a})})(n)},"Remove"))))),(0,e.createElement)(l.Button,{isPrimary:!0,onClick:()=>o({paramKeys:[...c,""]})},"Add Parameter")),(0,e.createElement)(l.PanelBody,{title:"Value Combinations",initialOpen:!1},m.map(((t,n)=>(0,e.createElement)("div",{key:n,style:{marginBottom:"1rem",padding:"0.5rem",border:n===b?"2px solid green":"1px solid #ccc",background:n===b?"#eaffea":"transparent"}},c.map((a=>(0,e.createElement)(l.TextControl,{key:a,label:`Value for "${a}"`,value:t[a]||"",onChange:e=>g(n,a,e)}))),(0,e.createElement)(l.TextControl,{label:"Output Value",value:t.value,onChange:e=>g(n,"value",e)}),(0,e.createElement)(l.Button,{isLink:!0,isDestructive:!0,onClick:()=>(e=>{const t=m.map((e=>({...e})));t.splice(e,1),o({combinations:t})})(n)},"Remove Combination")))),(0,e.createElement)(l.Button,{isPrimary:!0,onClick:()=>{const e=m.map((e=>({...e}))),t=Object.fromEntries(c.map((e=>[e,""])));t.value="",o({combinations:[...e,t]})}},"Add Combination")),(0,e.createElement)(l.PanelBody,{title:"Editor Preview",initialOpen:!1},(0,e.createElement)(l.ToggleControl,{label:"Enable Preview Mode",checked:s,onChange:e=>o({previewMode:e})}),(0,e.createElement)(l.ToggleControl,{label:"Use OR Logic (match any)",checked:p,onChange:e=>o({useOrLogic:e})}),s&&c.map((t=>(0,e.createElement)(l.TextControl,{key:t,label:`Preview value for "${t}"`,value:u[t]||"",onChange:e=>((e,t)=>{o({previewValues:{...u,[e]:t}})})(t,e)}))),s&&(0,e.createElement)(l.TextControl,{label:"Fallback Text",value:i,onChange:e=>o({fallbackText:e})}))),(0,e.createElement)("div",{...(0,n.useBlockProps)({style:{textAlign:d}})},(0,e.createElement)(n.RichText,{tagName:"div",value:s?y:r,onChange:e=>o({placeholderText:e}),placeholder:"Type display content like: Your rebate is: {{value}}"}))))},save:()=>null})})();