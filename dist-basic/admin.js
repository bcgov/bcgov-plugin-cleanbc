(()=>{"use strict";const e=window.React,t=window.wp.blocks,l=window.wp.blockEditor,a=window.wp.components,n=window.wp.element;(0,t.registerBlockType)("bcgovcleanbc/multi-query-content",{edit:({attributes:t,setAttributes:o})=>{const{placeholderText:r,fallbackText:i,paramKeys:c,combinations:s,previewMode:u,previewValues:m,useOrLogic:d,useParamValueDirect:p,alignment:v="left"}=t,g=(0,l.useBlockProps)({style:{textAlign:v}}),h=(e,t,l)=>{const a=s.map((e=>({...e})));a[e][t]=l,o({combinations:a})},b=s.findIndex((e=>d?c.some((t=>e[t]===m[t])):c.every((t=>e[t]===m[t]))));let E=r;if(u)if(p){const e=r.match(/{{\s*value(?:_\d+)?\s*}}/g)||[],t=[...new Set(e.map((e=>{const t=e.match(/\d+/);return t?parseInt(t[0],10)-1:0})))];t.every((e=>{const t=c[e];return t&&""!==m[t]}))?(E=r,t.forEach((e=>{const t=c[e],l=m[t]||"";E=E.replace(new RegExp(`{{\\s*value_${e+1}\\s*}}`,"g"),l),0===e&&(E=E.replace(/{{\s*value\s*}}/g,l))}))):E=i}else{let e=null;if(s.length>0){const t=s.findIndex((e=>d?c.some((t=>e[t]===m[t])):c.every((t=>e[t]===m[t]))));e=s[t]}E=e&&e.value?r.replace(/{{\s*value\s*}}/g,e.value):i}return(0,e.createElement)(n.Fragment,null,(0,e.createElement)(l.BlockControls,null,(0,e.createElement)(l.AlignmentToolbar,{value:v,onChange:e=>o({alignment:e})})),(0,e.createElement)(l.InspectorControls,null,(0,e.createElement)(a.PanelBody,{title:"Query Parameters"},c.map(((t,l)=>(0,e.createElement)("div",{key:l,style:{marginBottom:"0"}},(0,e.createElement)(a.TextControl,{label:`Param Key #${l+1}`,value:t,onChange:e=>((e,t)=>{const l=[...c];l[e]=t;const a=s.map((e=>({...e})));for(let e=0;e<a.length;e++)a[e]=Object.fromEntries(l.map((t=>{var l;return[t,null!==(l=a[e][t])&&void 0!==l?l:""]}))),a[e].value=s[e]?.value||"";o({paramKeys:l,combinations:a,previewValues:{}})})(l,e)}),(0,e.createElement)("div",{style:{textAlign:"right"}},(0,e.createElement)(a.Button,{isLink:!0,isDestructive:!0,onClick:()=>(e=>{const t=[...c],l=t.splice(e,1)[0],a=s.map((e=>{const t={...e};return delete t[l],t})),n={...m};delete n[l],o({paramKeys:t,combinations:a,previewValues:n})})(l)},"Remove"))))),(0,e.createElement)(a.Button,{isPrimary:!0,onClick:()=>o({paramKeys:[...c,""]})},"Add Parameter")),(0,e.createElement)(a.PanelBody,{title:"Value Combinations",initialOpen:!1},(0,e.createElement)(a.ToggleControl,{label:"Use parameter query string value(s) as output",checked:p,onChange:e=>{o({useParamValueDirect:e,combinations:e?[]:s})}}),p&&(0,e.createElement)("div",{style:{padding:"0 0.5rem 1rem",fontSize:"13px",color:"#555"}},(0,e.createElement)("strong",null,"Instructions:"),(0,e.createElement)("br",null),"You can reference each parameterâ€™s value in your placeholder using their value replacement pattern:",(0,e.createElement)("ul",null,c.map(((t,l)=>(0,e.createElement)("li",{key:l,style:{padding:"0 0 0.5rem"}},"For ",(0,e.createElement)("code",null,t)," placeholder use:",(0,e.createElement)("br",null)," ",0===l?"{{value}} or {{value_1}}":`{{value_${l+1}}}`))))),s.map(((t,l)=>(0,e.createElement)("div",{key:l,style:{marginBottom:"1rem",padding:"0.5rem",opacity:p?.5:1,pointerEvents:p?"none":"auto",border:l===b?"2px solid green":"1px solid #ccc",background:l===b?"#eaffea":"transparent"}},c.map((n=>(0,e.createElement)(a.TextControl,{key:n,label:`Value for "${n}"`,value:t[n]||"",onChange:e=>h(l,n,e)}))),(0,e.createElement)(a.TextControl,{label:"Output Value",value:t.value,onChange:e=>h(l,"value",e)}),(0,e.createElement)("div",{style:{textAlign:"right"}},(0,e.createElement)(a.Button,{isLink:!0,isDestructive:!0,onClick:()=>(e=>{const t=s.map((e=>({...e})));t.splice(e,1),o({combinations:t})})(l)},"Remove Combination"))))),(0,e.createElement)(a.Button,{isPrimary:!0,onClick:()=>{const e=s.map((e=>({...e}))),t=Object.fromEntries(c.map((e=>[e,""])));t.value="",o({combinations:[...e,t]})},disabled:p},"Add Combination")),(0,e.createElement)(a.PanelBody,{title:"Editor Preview",initialOpen:!1},(0,e.createElement)(a.ToggleControl,{label:"Enable Preview Mode",checked:u,onChange:e=>o({previewMode:e}),help:"Any placeholders like {{value}}, {{value_1}}, etc. inside your content will be replaced with the corresponding preview values you provide."}),(0,e.createElement)(a.ToggleControl,{label:"Use OR Logic (match any)",checked:d,onChange:e=>o({useOrLogic:e})}),u&&c.map(((t,l)=>(0,e.createElement)(a.TextControl,{key:t,label:`Preview value for "${t}"`,help:p?0===l?"Use {{value}} or {{value_1}} as the placeholder for this parameter.":`Use {{value_${l+1}}} as the placeholder for this parameter.`:"",value:m[t]||"",onChange:e=>((e,t)=>{o({previewValues:{...m,[e]:t}})})(t,e)}))),(0,e.createElement)(a.TextControl,{label:"Fallback Text (when nothing matches)",value:i,onChange:e=>o({fallbackText:e}),help:"When preview values do not find a valid match, the Fallback Text will be displayed instead of the placeholder content. If the Fallback Text is empty, 'No fallback text provided' will be output. Enable preview mode to test."}))),(0,e.createElement)("div",{...g},(0,e.createElement)(l.RichText,{tagName:"div",value:u?E:r,onChange:e=>o({placeholderText:e}),placeholder:u&&""===i?`No fallback text provided. Content with replacement pattern: ${r}`:void 0})))},save:()=>null});const o=[{label:"Equals",value:"equals"},{label:"Not Equals",value:"notEquals"},{label:"Contains",value:"contains"},{label:"Starts With",value:"startsWith"},{label:"Ends With",value:"endsWith"},{label:"Regex Match",value:"regex"},{label:"Exists (any value)",value:"exists"},{label:"Not Exists",value:"notExists"}];(0,t.registerBlockType)("bcgovcleanbc/query-conditional-group",{edit:({attributes:t,setAttributes:r})=>{const{rules:i=[],logic:c,invert:s,caseSensitive:u,clientSideCheck:m,hideUntilJs:d}=t,p=(0,l.useBlockProps)({className:"query-conditional-group-block",style:d?{outline:"1px dashed lightgray",outlineOffset:"0.5rem",marginBlock:"1rem"}:void 0}),v=(e,t,l)=>{const a=[...i];a[e]={...a[e],[t]:l},r({rules:a})};return(0,e.createElement)(n.Fragment,null,(0,e.createElement)(l.InspectorControls,null,(0,e.createElement)(a.PanelBody,{title:"Query Rules"},i.map(((t,l)=>(0,e.createElement)("div",{key:l,style:{border:"1px solid #ddd",padding:"8px",marginBottom:"8px"}},(0,e.createElement)(a.TextControl,{label:"Query key",value:t.key,onChange:e=>v(l,"key",e)}),!("exists"===t.operator||"notExists"===t.operator)&&(0,e.createElement)(a.TextControl,{label:"Required value",value:t.value,onChange:e=>v(l,"value",e)}),(0,e.createElement)(a.SelectControl,{label:"Operator",value:t.operator,options:o,onChange:e=>v(l,"operator",e)}),(0,e.createElement)(a.ToggleControl,{label:"Case Sensitive",checked:t.caseSensitive,onChange:e=>v(l,"caseSensitive",e)}),(0,e.createElement)("div",{style:{textAlign:"right"}},(0,e.createElement)(a.Button,{isLink:!0,isDestructive:!0,onClick:()=>(e=>{const t=[...i];t.splice(e,1),r({rules:t})})(l)},"Remove"))))),(0,e.createElement)(a.Button,{variant:"primary",onClick:()=>{r({rules:[...i,{key:"",value:"",operator:"equals",caseSensitive:!1}]})}},"Add rule")),(0,e.createElement)(a.PanelBody,{title:"Settings",initialOpen:!1},(0,e.createElement)(a.SelectControl,{label:"Logic Between Rules",value:c,options:[{label:"AND (all rules must match)",value:"AND"},{label:"OR (any rule matches)",value:"OR"}],onChange:e=>r({logic:e})}),(0,e.createElement)(a.ToggleControl,{label:"Invert (Show when NOT matching)",checked:s,onChange:e=>r({invert:e})}),(0,e.createElement)(a.ToggleControl,{label:"Case Sensitive (Global Default)",checked:u,onChange:e=>r({caseSensitive:e})}),(0,e.createElement)(a.ToggleControl,{label:"Enable Client-Side Check",checked:m,onChange:e=>r({clientSideCheck:e})}),(0,e.createElement)(a.ToggleControl,{label:"Hide Until JS Runs (Editor Hint)",checked:d,onChange:e=>r({hideUntilJs:e})}))),(0,e.createElement)("div",{...p},(0,e.createElement)("div",{style:{fontSize:"12px",color:"#aaa",marginBlock:"8px"}},"Conditional content: will only render if query rules match."),(0,e.createElement)(l.InnerBlocks,{templateLock:!1})))},save:()=>(0,e.createElement)(l.InnerBlocks.Content,null)});(0,t.registerBlockType)("bcgovcleanbc/query-filter-block",{edit:({attributes:t,setAttributes:o})=>{var r;const{selectedTaxonomy:i,label:c}=t,[s,u]=(0,n.useState)({}),m=null!==(r=window.queryFilterBlockData?.query)&&void 0!==r?r:{};(0,n.useEffect)((()=>{var e;fetch("/wp-json/custom/v1/meta-categories",{headers:{"X-WP-Nonce":null!==(e=window.queryFilterBlockData?.nonce)&&void 0!==e?e:""}}).then((e=>e.json())).then((e=>u(e)))}),[]);const d=i&&s[i]?[{label:"-- Select --",value:""},...s[i].map((({slug:e,name:t})=>({label:t,value:e})))]:[],p=(0,l.getTypographyClassesAndStyles)(t),v=(0,l.getColorClassName)("color",t.textColor),g=[p.className,v].filter(Boolean).join(" ");return(0,e.createElement)("div",{...(0,l.useBlockProps)({className:"query-filter-block","data-initialized":"false"})},(0,e.createElement)(l.InspectorControls,null,(0,e.createElement)(a.PanelBody,{title:"Filter Settings",initialOpen:!0},(0,e.createElement)(a.SelectControl,{label:"Select Taxonomy",value:i,onChange:e=>o({selectedTaxonomy:e}),options:Object.keys(s).map((e=>({label:e.replace(/-/g," "),value:e})))}),(0,e.createElement)(a.TextControl,{label:"Label Text",value:c,onChange:e=>o({label:e})}))),i&&d.length?(0,e.createElement)("div",{className:"query-filter-group"},(0,e.createElement)("label",{htmlFor:`select-${i}`,className:g,style:{...p.style,color:v?void 0:t.style?.color?.text}},c),(0,e.createElement)(a.SelectControl,{id:`select-${i}`,name:i,value:m[i]?.[0]||"",onChange:e=>(e=>{const t={...m};e?t[i]=[e]:delete t[i];const l=new URLSearchParams;for(const e in t)t[e].forEach((t=>l.append(e,t)));const a=document.querySelector(".query-filter-block");a?(a.classList.add("fade-out"),setTimeout((()=>{window.location.href=`${window.location.pathname}?${l.toString()}`}),200)):window.location.href=`${window.location.pathname}?${l.toString()}`})(e),options:d})):(0,e.createElement)(a.Spinner,null))},save:()=>null}),document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector(".query-filter-block");console.log(e),e&&window.queryFilterBlockData}))})();