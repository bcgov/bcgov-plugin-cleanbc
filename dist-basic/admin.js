(()=>{"use strict";const e=window.React,t=window.wp.blocks,l=window.wp.blockEditor,a=window.wp.components,n=window.wp.element;(0,t.registerBlockType)("bcgovcleanbc/multi-query-content",{edit:({attributes:t,setAttributes:r})=>{const{placeholderText:o,fallbackText:i,paramKeys:c,combinations:s,previewMode:m,previewValues:u,useOrLogic:p,useParamValueDirect:d,alignment:v="left"}=t,h=(0,l.useBlockProps)({style:{textAlign:v}}),g=(e,t,l)=>{const a=s.map((e=>({...e})));a[e][t]=l,r({combinations:a})},b=s.findIndex((e=>p?c.some((t=>e[t]===u[t])):c.every((t=>e[t]===u[t]))));let E=o;if(m)if(d){const e=o.match(/{{\s*value(?:_\d+)?\s*}}/g)||[],t=[...new Set(e.map((e=>{const t=e.match(/\d+/);return t?parseInt(t[0],10)-1:0})))];t.every((e=>{const t=c[e];return t&&""!==u[t]}))?(E=o,t.forEach((e=>{const t=c[e],l=u[t]||"";E=E.replace(new RegExp(`{{\\s*value_${e+1}\\s*}}`,"g"),l),0===e&&(E=E.replace(/{{\s*value\s*}}/g,l))}))):E=i}else{let e=null;if(s.length>0){const t=s.findIndex((e=>p?c.some((t=>e[t]===u[t])):c.every((t=>e[t]===u[t]))));e=s[t]}E=e&&e.value?o.replace(/{{\s*value\s*}}/g,e.value):i}return(0,e.createElement)(n.Fragment,null,(0,e.createElement)(l.BlockControls,null,(0,e.createElement)(l.AlignmentToolbar,{value:v,onChange:e=>r({alignment:e})})),(0,e.createElement)(l.InspectorControls,null,(0,e.createElement)(a.PanelBody,{title:"Query Parameters"},c.map(((t,l)=>(0,e.createElement)("div",{key:l,style:{marginBottom:"0"}},(0,e.createElement)(a.TextControl,{label:`Param Key #${l+1}`,value:t,onChange:e=>((e,t)=>{const l=[...c];l[e]=t;const a=s.map((e=>({...e})));for(let e=0;e<a.length;e++)a[e]=Object.fromEntries(l.map((t=>{var l;return[t,null!==(l=a[e][t])&&void 0!==l?l:""]}))),a[e].value=s[e]?.value||"";r({paramKeys:l,combinations:a,previewValues:{}})})(l,e)}),(0,e.createElement)("div",{style:{textAlign:"right"}},(0,e.createElement)(a.Button,{isLink:!0,isDestructive:!0,onClick:()=>(e=>{const t=[...c],l=t.splice(e,1)[0],a=s.map((e=>{const t={...e};return delete t[l],t})),n={...u};delete n[l],r({paramKeys:t,combinations:a,previewValues:n})})(l)},"Remove"))))),(0,e.createElement)(a.Button,{isPrimary:!0,onClick:()=>r({paramKeys:[...c,""]})},"Add Parameter")),(0,e.createElement)(a.PanelBody,{title:"Value Combinations",initialOpen:!1},(0,e.createElement)(a.ToggleControl,{label:"Use parameter query string value(s) as output",checked:d,onChange:e=>{r({useParamValueDirect:e,combinations:e?[]:s})}}),d&&(0,e.createElement)("div",{style:{padding:"0 0.5rem 1rem",fontSize:"13px",color:"#555"}},(0,e.createElement)("strong",null,"Instructions:"),(0,e.createElement)("br",null),"You can reference each parameterâ€™s value in your placeholder using their value replacement pattern:",(0,e.createElement)("ul",null,c.map(((t,l)=>(0,e.createElement)("li",{key:l,style:{padding:"0 0 0.5rem"}},"For ",(0,e.createElement)("code",null,t)," placeholder use:",(0,e.createElement)("br",null)," ",0===l?"{{value}} or {{value_1}}":`{{value_${l+1}}}`))))),s.map(((t,l)=>(0,e.createElement)("div",{key:l,style:{marginBottom:"1rem",padding:"0.5rem",opacity:d?.5:1,pointerEvents:d?"none":"auto",border:l===b?"2px solid green":"1px solid #ccc",background:l===b?"#eaffea":"transparent"}},c.map((n=>(0,e.createElement)(a.TextControl,{key:n,label:`Value for "${n}"`,value:t[n]||"",onChange:e=>g(l,n,e)}))),(0,e.createElement)(a.TextControl,{label:"Output Value",value:t.value,onChange:e=>g(l,"value",e)}),(0,e.createElement)("div",{style:{textAlign:"right"}},(0,e.createElement)(a.Button,{isLink:!0,isDestructive:!0,onClick:()=>(e=>{const t=s.map((e=>({...e})));t.splice(e,1),r({combinations:t})})(l)},"Remove Combination"))))),(0,e.createElement)(a.Button,{isPrimary:!0,onClick:()=>{const e=s.map((e=>({...e}))),t=Object.fromEntries(c.map((e=>[e,""])));t.value="",r({combinations:[...e,t]})},disabled:d},"Add Combination")),(0,e.createElement)(a.PanelBody,{title:"Editor Preview",initialOpen:!1},(0,e.createElement)(a.ToggleControl,{label:"Enable Preview Mode",checked:m,onChange:e=>r({previewMode:e}),help:"Any placeholders like {{value}}, {{value_1}}, etc. inside your content will be replaced with the corresponding preview values you provide."}),(0,e.createElement)(a.ToggleControl,{label:"Use OR Logic (match any)",checked:p,onChange:e=>r({useOrLogic:e})}),m&&c.map(((t,l)=>(0,e.createElement)(a.TextControl,{key:t,label:`Preview value for "${t}"`,help:d?0===l?"Use {{value}} or {{value_1}} as the placeholder for this parameter.":`Use {{value_${l+1}}} as the placeholder for this parameter.`:"",value:u[t]||"",onChange:e=>((e,t)=>{r({previewValues:{...u,[e]:t}})})(t,e)}))),(0,e.createElement)(a.TextControl,{label:"Fallback Text (when nothing matches)",value:i,onChange:e=>r({fallbackText:e}),help:"When preview values do not find a valid match, the Fallback Text will be displayed instead of the placeholder content. If the Fallback Text is empty, 'No fallback text provided' will be output. Enable preview mode to test."}))),(0,e.createElement)("div",{...h},(0,e.createElement)(l.RichText,{tagName:"div",value:m?E:o,onChange:e=>r({placeholderText:e}),placeholder:m&&""===i?`No fallback text provided. Content with replacement pattern: ${o}`:void 0})))},save:()=>null})})();